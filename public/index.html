<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AirBnB Guest Support</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .glass{background:rgba(255,255,255,0.05);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.1)}
    .speaking{animation:pulse 1s infinite;box-shadow:0 0 30px #10b981}
  </style>
</head>
<body class="bg-[#0a0a0f] min-h-screen text-white">
  
  <!-- GUEST MODE: Support Button Only -->
  <div id="guestView" class="min-h-screen flex flex-col items-center justify-center p-4">
    <div class="text-center mb-8">
      <div class="w-24 h-24 rounded-2xl bg-gradient-to-br from-red-500 to-pink-600 flex items-center justify-center mx-auto mb-4">
        <i class="fas fa-home text-4xl"></i>
      </div>
      <h1 class="text-3xl font-bold">Welcome</h1>
      <p class="text-slate-400 mt-2">Need help? Tap the phone to call support</p>
    </div>

    <div class="glass rounded-2xl p-6 w-full max-w-sm text-center">
      <p class="text-slate-400 text-sm mb-4">Your stay: <span id="guestProperty" class="text-white font-medium">Villa Sunset</span></p>
      <p class="text-slate-400 text-sm mb-6">Dates: <span id="guestDates" class="text-white">Mar 15-18</span></p>
      
      <button onclick="openSupport()" class="w-full py-4 bg-green-500 rounded-xl font-semibold flex items-center justify-center gap-2">
        <i class="fas fa-phone"></i> Call Support
      </button>
    </div>
  </div>

  <!-- VOICE SUPPORT PANEL -->
  <div id="voicePanel" class="fixed bottom-24 right-6 w-96 glass rounded-2xl p-6 hidden z-50">
    <div class="flex justify-between items-center mb-4">
      <h3 class="font-bold flex items-center gap-2"><i class="fas fa-headset text-green-400"></i> Voice Support</h3>
      <button onclick="closeSupport()" class="text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
    </div>
    
    <div id="elevenLabsSetup" class="mb-4 p-3 bg-yellow-500/10 rounded-xl border border-yellow-500/30">
      <p class="text-yellow-400 text-xs font-bold mb-2"><i class="fas fa-key mr-1"></i> ElevenLabs API Key</p>
      <input type="password" id="elevenApiKey" placeholder="sk_..." class="w-full bg-black/30 rounded-lg p-2 text-xs text-white placeholder-slate-500 mb-2">
      <div class="flex gap-2">
        <button onclick="saveApiKey()" class="flex-1 py-1 bg-yellow-500/20 text-yellow-400 rounded text-xs">Save</button>
        <button onclick="useBrowserVoice()" class="flex-1 py-1 bg-slate-600 rounded text-xs">Free Voice</button>
      </div>
    </div>

    <div id="voiceStatus" class="text-center py-4">
      <div id="voiceIcon" class="w-20 h-20 rounded-full bg-green-500/20 flex items-center justify-center mx-auto mb-4">
        <i class="fas fa-microphone text-3xl text-green-400"></i>
      </div>
      <p id="voiceText" class="text-slate-400">Click to call support</p>
    </div>

    <button onclick="startVoiceCall()" id="callBtn" class="w-full py-4 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl font-semibold flex items-center justify-center gap-2">
      <i class="fas fa-phone"></i> Start Voice Call
    </button>
    <button onclick="endCall()" id="endBtn" class="w-full py-3 bg-red-500/20 text-red-400 rounded-xl flex items-center justify-center gap-2 hidden">
      <i class="fas fa-phone-slash"></i> End Call
    </button>

    <div class="mt-4 pt-4 border-t border-white/10">
      <p class="text-xs text-slate-500 mb-2">Voice</p>
      <select id="voiceSelect" onchange="changeVoice()" class="w-full bg-white/5 rounded-lg p-2 text-sm">
        <option value="Rachel">Rachel (Premium)</option>
        <option value="Domi">Domi (Deep)</option>
        <option value="Bella">Bella (Soft)</option>
        <option value="Adam">Adam (Male)</option>
      </select>
    </div>
  </div>

  <!-- MANAGER LOGIN -->
  <div id="managerLogin" class="hidden min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md">
      <div class="text-center mb-8">
        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-red-500 to-pink-600 flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-building text-3xl"></i>
        </div>
        <h1 class="text-3xl font-bold text-white">AirBnB Manager</h1>
        <p class="text-slate-400 mt-2">Property Management Dashboard</p>
      </div>
      
      <div class="glass rounded-2xl p-8">
        <form id="loginForm" class="space-y-4">
          <input type="email" id="email" placeholder="Email" required class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-white placeholder-slate-500">
          <input type="password" id="password" placeholder="Password" required class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-white placeholder-slate-500">
          <button type="submit" class="w-full py-4 bg-gradient-to-r from-red-500 to-pink-600 rounded-xl font-semibold">Sign In</button>
        </form>
      </div>
      
      <button onclick="showGuestView()" class="w-full mt-4 py-3 bg-white/5 rounded-xl text-slate-400">
        ← Back to Guest View
      </button>
    </div>
  </div>

  <!-- MANAGER DASHBOARD -->
  <div id="dashboardView" class="hidden">
    <header class="glass sticky top-0 z-40">
      <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-red-500 to-pink-600 flex items-center justify-center">
            <i class="fas fa-home text-xl"></i>
          </div>
          <div>
            <h1 class="text-xl font-bold">AirBnB Command Center</h1>
            <p class="text-xs text-slate-400">Property Management</p>
          </div>
        </div>
        <div class="flex items-center gap-4">
          <button onclick="showGuestView()" class="px-4 py-2 bg-white/10 rounded-xl text-sm"><i class="fas fa-eye mr-2"></i>Preview Guest View</button>
          <button onclick="logout()" class="px-4 py-2 bg-white/10 rounded-xl"><i class="fas fa-sign-out-alt mr-2"></i>Logout</button>
        </div>
      </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-8">
      <div class="grid grid-cols-5 gap-4 mb-8">
        <div class="glass rounded-2xl p-5"><p class="text-slate-400 text-sm">Properties</p><p class="text-3xl font-bold" id="totalProperties">12</p></div>
        <div class="glass rounded-2xl p-5"><p class="text-slate-400 text-sm">Bookings</p><p class="text-3xl font-bold text-green-400" id="activeBookings">8</p></div>
        <div class="glass rounded-2xl p-5"><p class="text-slate-400 text-sm">Revenue</p><p class="text-3xl font-bold">$24,500</p></div>
        <div class="glass rounded-2xl p-5"><p class="text-slate-400 text-sm">Reviews</p><p class="text-3xl font-bold text-yellow-400">4.9★</p></div>
        <div class="glass rounded-2xl p-5"><p class="text-slate-400 text-sm">Occupancy</p><p class="text-3xl font-bold text-purple-400">87%</p></div>
      </div>

      <div class="grid lg:grid-cols-3 gap-8">
        <div class="glass rounded-2xl p-6">
          <h2 class="text-lg font-bold mb-4"><i class="fas fa-calendar-check text-red-400 mr-2"></i>Check-ins</h2>
          <div id="bookingsList" class="space-y-3"></div>
        </div>

        <div class="glass rounded-2xl p-6">
          <h2 class="text-lg font-bold mb-4"><i class="fas fa-robot text-purple-400 mr-2"></i>Automation</h2>
          <div id="automationQueue" class="space-y-3"></div>
        </div>

        <div class="glass rounded-2xl p-6">
          <h2 class="text-lg font-bold mb-4"><i class="fas fa-bolt text-yellow-400 mr-2"></i>Actions</h2>
          <div class="grid grid-cols-2 gap-3">
            <button onclick="openModal('addProperty')" class="bg-white/5 rounded-xl p-4 text-left">
              <i class="fas fa-plus-circle text-green-400 mb-2"></i><p class="font-medium">Add Property</p>
            </button>
            <button onclick="openModal('newBooking')" class="bg-white/5 rounded-xl p-4 text-left">
              <i class="fas fa-calendar-plus text-blue-400 mb-2"></i><p class="font-medium">New Booking</p>
            </button>
            <button onclick="updatePrices()" class="bg-white/5 rounded-xl p-4 text-left">
              <i class="fas fa-dollar-sign text-yellow-400 mb-2"></i><p class="font-medium">Prices</p>
            </button>
            <button onclick="syncCalendars()" class="bg-white/5 rounded-xl p-4 text-left">
              <i class="fas fa-sync text-purple-400 mb-2"></i><p class="font-medium">Sync</p>
            </button>
          </div>
        </div>
      </div>

      <div class="glass rounded-2xl p-6 mt-8">
        <h2 class="text-lg font-bold mb-4"><i class="fas fa-building text-indigo-400 mr-2"></i>Properties</h2>
        <table class="w-full">
          <thead>
            <tr class="text-left text-slate-400 text-sm border-b border-white/10">
              <th class="pb-3">Property</th><th class="pb-3">Bookings</th><th class="pb-3">Revenue</th>
              <th class="pb-3">Occupancy</th><th class="pb-3">Status</th><th class="pb-3">Actions</th>
            </tr>
          </thead>
          <tbody id="propertiesList"></tbody>
        </table>
      </div>
    </main>
  </div>

  <!-- MODALS -->
  <div id="addPropertyModal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50">
    <div class="glass rounded-2xl p-8 w-full max-w-md">
      <h3 class="text-xl font-bold mb-6">Add Property</h3>
      <form id="addPropertyForm" class="space-y-4">
        <input type="text" id="propName" placeholder="Property Name" required class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white placeholder-slate-500">
        <input type="text" id="propLocation" placeholder="Location" required class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white placeholder-slate-500">
        <input type="number" id="propPrice" placeholder="Price/night" required class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white placeholder-slate-500">
        <input type="number" id="propBedrooms" placeholder="Bedrooms" required class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white placeholder-slate-500">
        <button type="submit" class="w-full py-4 bg-gradient-to-r from-red-500 to-pink-600 rounded-xl font-semibold">Add</button>
      </form>
      <button onclick="closeModal('addProperty')" class="mt-4 w-full py-2 text-slate-400">Cancel</button>
    </div>
  </div>

  <div id="newBookingModal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50">
    <div class="glass rounded-2xl p-8 w-full max-w-md">
      <h3 class="text-xl font-bold mb-6">New Booking</h3>
      <form id="newBookingForm" class="space-y-4">
        <input type="text" id="guestName" placeholder="Guest Name" required class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white placeholder-slate-500">
        <select id="bookingProperty" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white"></select>
        <div class="grid grid-cols-2 gap-4">
          <input type="date" id="checkIn" required class="w-full bg-white//10 rounded-xl5 border border-white p-3 text-white">
          <input type="date" id="checkOut" required class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white">
        </div>
        <button type="submit" class="w-full py-4 bg-gradient-to-r from-red-500 to-pink-600 rounded-xl font-semibold">Create</button>
      </form>
      <button onclick="closeModal('newBooking')" class="mt-4 w-full py-2 text-slate-400">Cancel</button>
    </div>
  </div>

  <script>
    // Voice System
    const voiceIds = { 'Rachel': '21m00Tcm4TlvDq8ikWAM', 'Domi': 'AZnzlk1XvdvZsBnRSFIJ', 'Bella': 'EXAVITQu4vr4xnSDxMaL', 'Adam': 'pNInz6obpgDQGcFmaJgB' };
    let isCallActive = false, recognition = null, apiKey = localStorage.getItem('elevenApiKey') || '', selectedVoice = localStorage.getItem('elevenVoice') || 'Rachel', useElevenLabs = !!apiKey;

    if (!apiKey) document.getElementById('elevenLabsSetup').classList.remove('hidden');
    document.getElementById('voiceSelect').value = selectedVoice;

    function saveApiKey() {
      const key = document.getElementById('elevenApiKey').value.trim();
      if (key.startsWith('sk_')) {
        localStorage.setItem('elevenApiKey', key); apiKey = key; useElevenLabs = true;
        document.getElementById('elevenLabsSetup').classList.add('hidden');
      }
    }
    function useBrowserVoice() { localStorage.removeItem('elevenApiKey'); apiKey = ''; useElevenLabs = false; document.getElementById('elevenLabsSetup').classList.add('hidden'); }
    function changeVoice() { selectedVoice = document.getElementById('voiceSelect').value; localStorage.setItem('elevenVoice', selectedVoice); }

    const supportResponses = {
      'checkin': "Your check-in time is 3 PM. The address will be sent 24 hours before arrival.",
      'checkout': "Checkout is at 11 AM. Please leave the keys in the lockbox.",
      'wifi': "The WiFi password is on the welcome card in the kitchen. It's vacation2024.",
      'password': "The WiFi password is on the welcome card in the kitchen. It's vacation2024.",
      'parking': "Free parking is available. The gate code is 1234.",
      'pool': "The pool is open from 6 AM to 10 PM. Towels are in the hallway.",
      'ac': "The air conditioning is controlled by the wall thermostat. Set it to your preferred temperature.",
      'lock': "If you're locked out, call this number and we'll send help immediately.",
      'key': "The key is in the smart lock. Use the code I sent to your phone.",
      'problem': "I'm sorry to hear that. I'm alerting the property manager right away.",
      'emergency': "For emergencies, please dial 911. For other issues, I'm here to help.",
      'help': "I can help with check-in, checkout, WiFi, parking, pool, and more. What do you need?",
      'thank': "You're welcome! Anything else I can help with?",
      'bye': "Thank you for calling! Enjoy your stay!",
    };

    function openSupport() { document.getElementById('voicePanel').classList.remove('hidden'); }
    function closeSupport() { document.getElementById('voicePanel').classList.add('hidden'); }

    async function speakWithElevenLabs(text) {
      try {
        const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceIds[selectedVoice]}`, {
          method: 'POST', headers: { 'Accept': 'audio/mpeg', 'Content-Type': 'application/json', 'xi-api-key': apiKey },
          body: JSON.stringify({ text, model_id: 'eleven_multilingual_v2', voice_settings: { stability: 0.5, similarity_boost: 0.8 } })
        });
        const audioBlob = await response.blob();
        const audio = new Audio(URL.createObjectURL(audioBlob)); audio.play();
      } catch { speakWithBrowser(text); }
    }

    function speakWithBrowser(text) { const u = new SpeechSynthesisUtterance(text); speechSynthesis.speak(u); }
    function speak(text) { useElevenLabs && apiKey ? speakWithElevenLabs(text) : speakWithBrowser(text); }

    function startVoiceCall() {
      isCallActive = true;
      document.getElementById('voiceIcon').classList.add('speaking');
      document.getElementById('voiceText').textContent = 'Listening...';
      document.getElementById('callBtn').classList.add('hidden');
      document.getElementById('endBtn').classList.remove('hidden');
      speak("Hello! Welcome to AirBnB support. How can I help you today?");
      
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.continuous = true;
        recognition.onresult = (e) => { if (e.results[0].isFinal) handleVoiceInput(e.results[0][0].transcript.toLowerCase()); };
        recognition.start();
      }
    }

    function handleVoiceInput(input) {
      let response = "I'm not sure I understood. Can you try again?";
      for (const [key, value] of Object.entries(supportResponses)) { if (input.includes(key)) { response = value; break; } }
      speak(response);
    }

    function endCall() {
      isCallActive = false; speechSynthesis.cancel();
      if (recognition) recognition.stop();
      document.getElementById('voiceIcon').classList.remove('speaking');
      document.getElementById('voiceText').textContent = 'Click to call support';
      document.getElementById('callBtn').classList.remove('hidden');
      document.getElementById('endBtn').classList.add('hidden');
      speak("Thank you! Have a great day!");
    }

    // Manager Data
    let properties = [
      { id: 1, name: 'Villa Sunset', location: 'Miami Beach, FL', price: 250, bookings: 12, revenue: 18500, occupancy: 92, status: 'active' },
      { id: 2, name: 'Cozy Apartment', location: 'New York, NY', price: 180, bookings: 8, revenue: 12400, occupancy: 78, status: 'active' },
    ];
    let bookings = [
      { id: 1, guest: 'John Davis', propertyId: 1, checkIn: '2026-03-15', checkOut: '2026-03-18', total: 850, status: 'confirmed' },
    ];

    function showGuestView() {
      document.getElementById('managerLogin').classList.add('hidden');
      document.getElementById('dashboardView').classList.add('hidden');
      document.getElementById('guestView').classList.remove('hidden');
    }

    function showManagerLogin() {
      document.getElementById('guestView').classList.add('hidden');
      document.getElementById('managerLogin').classList.remove('hidden');
    }

    document.getElementById('loginForm').addEventListener('submit', function(e) {
      e.preventDefault();
      localStorage.setItem('managerLoggedIn', 'true');
      document.getElementById('managerLogin').classList.add('hidden');
      document.getElementById('dashboardView').classList.remove('hidden');
      renderDashboard();
    });

    function logout() {
      localStorage.removeItem('managerLoggedIn');
      document.getElementById('dashboardView').classList.add('hidden');
      showGuestView();
    }

    function renderDashboard() {
      document.getElementById('propertiesList').innerHTML = properties.map(p => `
        <tr class="border-b border-white/5">
          <td class="py-3"><p class="font-medium">${p.name}</p><p class="text-slate-400 text-xs">${p.location}</p></td>
          <td>${p.bookings}</td><td>$${p.revenue.toLocaleString()}</td>
          <td><span class="${p.occupancy >= 80 ? 'text-green-400' : 'text-yellow-400'}">${p.occupancy}%</span></td>
          <td><span class="px-2 py-1 rounded text-xs ${p.status === 'active' ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'}">${p.status}</span></td>
          <td><button onclick="deleteProperty(${p.id})" class="text-red-400"><i class="fas fa-trash"></i></button></td>
        </tr>`).join('');
      document.getElementById('totalProperties').textContent = properties.length;
      document.getElementById('activeBookings').textContent = bookings.length;
      document.getElementById('bookingProperty').innerHTML = properties.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
      document.getElementById('bookingsList').innerHTML = bookings.map(b => `<div class="bg-white/5 rounded-xl p-3"><p class="font-medium">${b.guest}</p><p class="text-slate-400 text-xs">${b.checkIn} → ${b.checkOut} • $${b.total}</p></div>`).join('');
      document.getElementById('automationQueue').innerHTML = `
        <div class="bg-white/5 rounded-xl p-3 flex items-center gap-3"><i class="fas fa-envelope text-green-400"></i><span class="text-sm">Welcome message sent</span><span class="text-green-400 ml-auto">✓</span></div>
        <div class="bg-white/5 rounded-xl p-3 flex items-center gap-3"><i class="fas fa-bell text-yellow-400"></i><span class="text-sm">Checkout reminder</span><span class="text-yellow-400 ml-auto">⏳</span></div>`;
    }

    function openModal(type) { document.getElementById(type + 'Modal').classList.remove('hidden'); document.getElementById(type + 'Modal').classList.add('flex'); }
    function closeModal(type) { document.getElementById(type + 'Modal').classList.add('hidden'); document.getElementById(type + 'Modal').classList.remove('flex'); }

    document.getElementById('addPropertyForm').addEventListener('submit', function(e) {
      e.preventDefault();
      properties.push({ id: Date.now(), name: document.getElementById('propName').value, location: document.getElementById('propLocation').value, price: parseInt(document.getElementById('propPrice').value), bookings: 0, revenue: 0, occupancy: 0, status: 'active', bedrooms: parseInt(document.getElementById('propBedrooms').value) });
      renderDashboard(); closeModal('addProperty'); this.reset();
    });

    document.getElementById('newBookingForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const prop = properties.find(p => p.id === parseInt(document.getElementById('bookingProperty').value));
      const nights = Math.ceil((new Date(document.getElementById('checkOut').value) - new Date(document.getElementById('checkIn').value)) / (1000*60*60*24));
      bookings.push({ id: Date.now(), guest: document.getElementById('guestName').value, propertyId: parseInt(document.getElementById('bookingProperty').value), checkIn: document.getElementById('checkIn').value, checkOut: document.getElementById('checkOut').value, total: nights * prop.price, status: 'confirmed' });
      renderDashboard(); closeModal('newBooking'); this.reset();
    });

    function updatePrices() { properties.forEach(p => { p.price = Math.round(p.price * (1 + (Math.random() * 0.2 - 0.1))); }); renderDashboard(); alert('Prices updated!'); }
    function syncCalendars() { alert('Syncing calendars...'); }
    function deleteProperty(id) { if(confirm('Delete?')) { properties = properties.filter(p => p.id !== id); renderDashboard(); } }

    // Init
    document.addEventListener('DOMContentLoaded', function() {
      if (localStorage.getItem('managerLoggedIn') === 'true') {
        document.getElementById('guestView').classList.add('hidden');
        document.getElementById('dashboardView').classList.remove('hidden');
        renderDashboard();
      }
    });
  </script>
</body>
</html>
